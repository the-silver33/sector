<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Griglia 60x80</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
	<h1>Mappa</h1>

	<button class="grid-button" onclick="handleButtonClick()">Cliccami!</button>

	<div id="zoom-container">
		<div class="grid-container" id="grid">
			<!-- La griglia verrÃ  generata dinamicamente con JavaScript -->
		</div>
	</div>

	<script>

const gridContainer = document.getElementById('grid');
let zoom = 1;

/* ---------------------------
    CREA LA GRIGLIA DINAMICA
----------------------------*/
function createGrid(rows, cols, data) {
  gridContainer.innerHTML = "";

  const CELL_SIZE = 20;
  gridContainer.style.gridTemplateColumns = `repeat(${cols}, ${CELL_SIZE}px)`;
  gridContainer.style.gridAutoRows = `${CELL_SIZE}px`;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement("div");
      cell.className = "grid-cell";

      const value = data[r] && data[r][c] ? data[r][c] : "";
      switch(value) { //in caso che ti dimentichi
        case "p": // pianura
          cell.style.backgroundColor = "#7ec850";
          break;
        case "ma": // mare
          cell.style.backgroundColor = "#1e90ff";
          break;
        case "s": // spiaggia
          cell.style.backgroundColor = "#e0c36f";
          break;
        case "f": // fiume
          cell.style.backgroundColor = "#00bfff";
          break;
        case "raf": case "mag": // raffineria e magazzino
          cell.style.backgroundColor = "#a9a9a9";
          break;
        case "ponte": case "har": // ponte (crazy eh) e porto
          cell.style.backgroundColor = "#c48755";
          break;

        default:
          cell.style.backgroundColor = "#222222";
      }


      gridContainer.appendChild(cell);
    }
  }
}


/* ---------------------------
      BOTTONE DI TEST
----------------------------*/
function handleButtonClick() {
  window.location.href = 'https://the-silver33.github.io/sector/test.html';
}

/* ---------------------------
     ZOOM + MOVIMENTO
----------------------------*/
let zoomContainer = document.getElementById("zoom-container");

zoomContainer.addEventListener("wheel", e => {
  if (!e.ctrlKey) return;
  e.preventDefault();

  zoom += e.deltaY * -0.001;
  zoom = Math.min(Math.max(zoom, 1), 3);

  gridContainer.style.transform = `scale(${zoom})`;
});

document.addEventListener("keydown", (e) => {
  const step = 50;

  switch (e.key.toLowerCase()) {
    case "arrowup": case "w":
      zoomContainer.scrollTop -= step;
      break;
    case "arrowdown": case "s":
      zoomContainer.scrollTop += step;
      break;
    case "arrowleft": case "a":
      zoomContainer.scrollLeft -= step;
      break;
    case "arrowright": case "d":
      zoomContainer.scrollLeft += step;
      break;
  }
});

/* ---------------------------
       GOOGLE SHEET
----------------------------*/

// ID del foglio
const SHEET_ID = "1Uoz5xYisxmd7uUUIFrsAX-yZ4mckYSUdSopG2pNaL1k";
const SHEET_NAME = "mappa";
const API_KEY = "AIzaSyAjSe4WyZIJyGk5HLMMytZcm_s4xQJKNU4";

async function loadSheetData() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;

  try {
    const res = await fetch(url);
    const json = await res.json();

    const data = json.values || [];
	  const mapData = data.slice(1).map(row => row.slice(1)) //toglie prima riga e prima colonna

    // Calcolo dinamico righe/colonne
    const rows = mapData.length;
    const cols = Math.max(...mapData.map(r => r.length));

    console.log("Righe:", rows, "Colonne:", cols);

    // Crea e riempi
    createGrid(rows, cols, mapData);

  } catch (err) {
    console.error("Errore caricamento Google Sheet:", err);
  }
}

// carica dati al caricamento pagina
window.addEventListener('DOMContentLoaded', loadSheetData);

</script>

</body>

</html>
