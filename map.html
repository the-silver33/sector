<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Griglia 60x80</title>
	<style>
		
		body {
			margin: 0;
			font-family: Arial, sans-serif;
		}

		.grid-button {
			padding: 10px 20px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 16px;
			transition: background-color 0.3s;
		}

		.grid-button:hover {
			background-color: #45a049;
		}

		.grid-container {
			display: grid;
			margin: 10px auto;
			border: 1px solid #ccc;
			background-color: #f0f0f0;
			transform-origin: 0 0;
			overflow: scroll;
			width: max-content;
			height: max-content;
		}

		.grid-cell {
			background-color: white;
			border: 1px solid #e0e0e0;
			transition: background-color 0.2s;
			width: 10px;
			height: 10px;
		}

		#zoom-container {
			overflow: auto;
		}
	</style>
</head>

<body>
	<h1>Mappa</h1>

	<button class="grid-button" onclick="handleButtonClick()">Cliccami!</button>

	<div id="zoom-container">
		<div class="grid-container" id="grid">
			<!-- La griglia verrÃ  generata dinamicamente con JavaScript -->
		</div>
	</div>

	<script>

const gridContainer = document.getElementById('grid');
let zoom = 1;

/* ---------------------------
    CREA LA GRIGLIA DINAMICA
----------------------------*/
function createGrid(rows, cols) {
  gridContainer.innerHTML = "";

  const CELL_SIZE = 20; // celle quadrate

  gridContainer.style.gridTemplateColumns = `repeat(${cols}, ${CELL_SIZE}px)`;
  gridContainer.style.gridAutoRows = `${CELL_SIZE}px`;

  for (let i = 0; i < rows * cols; i++) {
    const cell = document.createElement("div");
    cell.className = "grid-cell";
    gridContainer.appendChild(cell);
  }
}

/* ---------------------------
      RIEMPI LA GRIGLIA
----------------------------*/
function fillGrid(data, rows, cols) {
  const cells = gridContainer.children;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const index = r * cols + c;
      const value = data[r] && data[r][c] ? data[r][c] : "";
      cells[index].textContent = value;
    }
  }
}

/* ---------------------------
      BOTTONE DI TEST
----------------------------*/
function handleButtonClick() {
  window.location.href = 'https://the-silver33.github.io/sector/test.html';
}

/* ---------------------------
     ZOOM + MOVIMENTO
----------------------------*/
let zoomContainer = document.getElementById("zoom-container");

zoomContainer.addEventListener("wheel", e => {
  if (!e.ctrlKey) return;
  e.preventDefault();

  zoom += e.deltaY * -0.001;
  zoom = Math.min(Math.max(zoom, 1), 3);

  gridContainer.style.transform = `scale(${zoom})`;
});

document.addEventListener("keydown", (e) => {
  const step = 50;

  switch (e.key.toLowerCase()) {
    case "arrowup": case "w":
      zoomContainer.scrollTop -= step;
      break;
    case "arrowdown": case "s":
      zoomContainer.scrollTop += step;
      break;
    case "arrowleft": case "a":
      zoomContainer.scrollLeft -= step;
      break;
    case "arrowright": case "d":
      zoomContainer.scrollLeft += step;
      break;
  }
});

/* ---------------------------
       GOOGLE SHEET
----------------------------*/

// ID del foglio
const SHEET_ID = "1Uoz5xYisxmd7uUUIFrsAX-yZ4mckYSUdSopG2pNaL1k";
const SHEET_NAME = "mappa";
const API_KEY = "AIzaSyAjSe4WyZIJyGk5HLMMytZcm_s4xQJKNU4";

async function loadSheetData() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;

  try {
    const res = await fetch(url);
    const json = await res.json();

    const data = json.values || [];

    // Calcolo dinamico righe/colonne
    const rows = data.length;
    const cols = Math.max(...data.map(r => r.length));

    console.log("Righe:", rows, "Colonne:", cols);

    // Crea e riempi
    createGrid(rows, cols);
    fillGrid(data, rows, cols);

  } catch (err) {
    console.error("Errore caricamento Google Sheet:", err);
  }
}

// carica dati al caricamento pagina
window.addEventListener('DOMContentLoaded', loadSheetData);

</script>

</body>

</html>
